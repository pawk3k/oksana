/*!
 * @pixi/text-bitmap - v5.3.0
 * Compiled Thu, 18 Jun 2020 23:27:40 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
this.PIXI=this.PIXI||{};var _pixi_text_bitmap=function(t,e,i,r,n,a,o,s,h){"use strict";var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var l=function(){return function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}}(),u=[function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[]};for(var r in e){var n=e[r].match(/^[a-z]+/gm)[0],a=e[r].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(var s in a){var h=a[s].split("="),f=h[0],u=h[1].replace(/"/gm,""),c=parseFloat(u),p=isNaN(c)?u:c;o[f]=p}i[n].push(o)}var g=new l;return i.info.forEach(function(t){return g.info.push({face:t.face,size:parseInt(t.size,10)})}),i.common.forEach(function(t){return g.common.push({lineHeight:parseInt(t.lineHeight,10)})}),i.page.forEach(function(t){return g.page.push({id:parseInt(t.id,10),file:t.file})}),i.char.forEach(function(t){return g.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})}),i.kerning.forEach(function(t){return g.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})}),g},t}(),function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new l,i=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),s=0;s<i.length;s++)e.info.push({face:i[s].getAttribute("face"),size:parseInt(i[s].getAttribute("size"),10)});for(s=0;s<r.length;s++)e.common.push({lineHeight:parseInt(r[s].getAttribute("lineHeight"),10)});for(s=0;s<n.length;s++)e.page.push({id:parseInt(n[s].getAttribute("id"),10)||0,file:n[s].getAttribute("file")});for(s=0;s<a.length;s++){var h=a[s];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(s=0;s<o.length;s++)e.kerning.push({first:parseInt(o[s].getAttribute("first"),10),second:parseInt(o[s].getAttribute("second"),10),amount:parseInt(o[s].getAttribute("amount"),10)});return e},t}()];function c(t){for(var e=0;e<u.length;e++)if(u[e].test(t))return u[e];return null}function p(t,e,i,r,n,a){var s,h=i.fill;if(!Array.isArray(h))return h;if(1===h.length)return h[0];var f=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,u=Math.ceil(t.width/r)-f-2*l,c=Math.ceil(t.height/r)-f-2*l,p=h.slice(),g=i.fillGradientStops.slice();if(!g.length)for(var d=p.length+1,m=1;m<d;++m)g.push(m/d);if(p.unshift(h[0]),g.unshift(0),p.push(h[h.length-1]),g.push(1),i.fillGradientType===o.TEXT_GRADIENT.LINEAR_VERTICAL){s=e.createLinearGradient(u/2,l,u/2,c+l);var v=0,x=(a.fontProperties.fontSize+i.strokeThickness)/c;for(m=0;m<n.length;m++)for(var y=a.lineHeight*m,b=0;b<p.length;b++){var _=y/c+("number"==typeof g[b]?g[b]:b/p.length)*x,I=Math.max(v,_);I=Math.min(I,1),s.addColorStop(I,p[b]),v=I}}else{s=e.createLinearGradient(l,c/2,u+l,c/2);var w=p.length+1,T=1;for(m=0;m<p.length;m++){var A=void 0;A="number"==typeof g[m]?g[m]:T/w,s.addColorStop(A,p[m]),T++}}return s}function g(t,e,i,r,a,o,s){var h=i.text,f=i.fontProperties;e.translate(r,a),e.scale(o,o);var l=s.strokeThickness/2,u=-s.strokeThickness/2;e.font=s.toFontString(),e.lineWidth=s.strokeThickness,e.textBaseline=s.textBaseline,e.lineJoin=s.lineJoin,e.miterLimit=s.miterLimit,e.fillStyle=p(t,e,s,o,[h],i),e.strokeStyle=s.stroke,e.font=s.toFontString(),e.lineWidth=s.strokeThickness,e.textBaseline=s.textBaseline,e.lineJoin=s.lineJoin,e.miterLimit=s.miterLimit,e.fillStyle=p(t,e,s,o,[h],i),e.strokeStyle=s.stroke;var c=s.dropShadowColor,g=n.hex2rgb("number"==typeof c?c:n.string2hex(c));s.dropShadow?(e.shadowColor="rgba("+255*g[0]+","+255*g[1]+","+255*g[2]+","+s.dropShadowAlpha+")",e.shadowBlur=s.dropShadowBlur,e.shadowOffsetX=Math.cos(s.dropShadowAngle)*s.dropShadowDistance,e.shadowOffsetY=Math.sin(s.dropShadowAngle)*s.dropShadowDistance):(e.shadowColor="0",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),s.stroke&&s.strokeThickness&&e.strokeText(h,l,u+i.lineHeight-f.descent),s.fill&&e.fillText(h,l,u+i.lineHeight-f.descent),e.setTransform(),e.fillStyle="rgba(0, 0, 0, 0)"}var d=function(){function t(t,i){var r=t.info[0],o=t.common[0],s=t.page[0],h=n.getResolutionOfUrl(s.file),f={};for(var l in this.font=r.face,this.size=r.size,this.lineHeight=o.lineHeight/h,this.chars={},this.pageTextures=f,t.page){var u=t.page[l],c=u.id,p=u.file;f[c]=i instanceof Array?i[l]:i[p]}for(var l in t.char){var g=t.char[l],d=(c=g.id,g.page),m=t.char[l],v=m.x,x=m.y,y=m.width,b=m.height,_=m.xoffset,I=m.yoffset,w=m.xadvance;v/=h,x/=h,y/=h,b/=h,_/=h,I/=h,w/=h;var T=new e.Rectangle(v+f[d].frame.x/h,x+f[d].frame.y/h,y,b);this.chars[c]={xOffset:_,yOffset:I,xAdvance:w,kerning:{},texture:new a.Texture(f[d].baseTexture,T),page:d}}for(var l in t.kerning){var A=t.kerning[l],S=A.first,P=A.second,E=A.amount;S/=h,P/=h,E/=h,this.chars[P]&&(this.chars[P].kerning[S]=E)}}return t.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},t.install=function(e,i){var r;if(e instanceof l)r=e;else{var n=c(e);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(e)}i instanceof a.Texture&&(i=[i]);var o=new t(r,i);return t.available[o.font]=o,o},t.uninstall=function(e){var i=t.available[e];if(!i)throw new Error("No font found named '"+e+"'");i.destroy(),delete t.available[e]},t.from=function(e,i,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},t.defaultOptions,r),s=n.chars,h=n.padding,f=n.resolution,u=n.textureWidth,c=n.textureHeight,p=function(t){"string"==typeof t&&(t=[t]);for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var a=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<a)throw new Error("[BitmapFont]: Invalid character range.");for(var s=a,h=o;s<=h;s++)e.push(String.fromCharCode(s))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),d=i instanceof o.TextStyle?i:new o.TextStyle(i),m=u,v=new l;v.info[0]={face:d.fontFamily,size:d.fontSize},v.common[0]={lineHeight:d.fontSize};for(var x,y,b,_=0,I=0,w=0,T=[],A=[],S=0;S<p.length;S++){x||((x=document.createElement("canvas")).width=u,x.height=c,y=x.getContext("2d"),b=new a.BaseTexture(x,{resolution:f}),T.push(b),A.push(new a.Texture(b)),v.page.push({id:A.length-1,file:""}));var P=o.TextMetrics.measureText(p[S],d,!1,x),E=P.width,O=Math.ceil(P.height),B=Math.ceil(("italic"===d.fontStyle?2:1)*E);if(I>=c-O*f){if(0===I)throw new Error("[BitmapFont] textureHeight "+c+"px is too small for "+d.fontSize+"px fonts");x=null,y=null,b=null,I=0,_=0,w=0}else if(w=Math.max(O+P.fontProperties.descent,w),B*f+_>=m)--S,I+=w*f,I=Math.ceil(I),_=0,w=0;else{g(x,y,P,_,I,f,d);var M=P.text.charCodeAt(0);v.char[M]={id:M,page:A.length-1,x:_/f,y:I/f,width:B,height:O,xoffset:0,yoffset:0,xadvance:Math.ceil(E-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))},_+=(B+2*h)*f,_=Math.ceil(_)}}var k=new t(v,A);return void 0!==t.available[e]&&t.uninstall(e),t.available[e]=k,k},t.ALPHA=[["a","z"],["A","Z"]," "],t.NUMERIC=[["0","9"]],t.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],t.ASCII=[[" ","~"]],t.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:t.ALPHANUMERIC},t.available={},t}(),m=[],v=[],x=function(t){function o(r,a){void 0===a&&(a={});var s=t.call(this)||this;s._tint=16777215,a.font&&(n.deprecation("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),s._upgradeStyle(a));var h=Object.assign({},o.styleDefaults,a),f=h.align,l=h.tint,u=h.maxWidth,c=h.letterSpacing,p=h.fontName,g=h.fontSize;if(!d.available[p])throw new Error('Missing BitmapFont "'+p+'"');return s._activePagesMeshData=[],s._textWidth=0,s._textHeight=0,s._align=f,s._tint=l,s._fontName=p,s._fontSize=g||d.available[p].size,s._text=r,s._maxWidth=u,s._maxLineHeight=0,s._letterSpacing=c,s._anchor=new e.ObservablePoint(function(){s.dirty=!0},s,0,0),s.roundPixels=i.settings.ROUND_PIXELS,s.dirty=!0,s}return function(t,e){function i(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(o,t),o.prototype.updateText=function(){for(var t,i=d.available[this._fontName],o=this._fontSize/i.size,s=new e.Point,h=[],f=[],l=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",u=l.length,c=this._maxWidth*i.size/this._fontSize,p=null,g=0,x=0,y=0,b=-1,_=0,I=0,w=0,T=0;T<u;T++){var A=l.charCodeAt(T),S=l.charAt(T);if(/(?:\s)/.test(S)&&(b=T,_=g),"\r"!==S&&"\n"!==S){var P=i.chars[A];if(P){p&&P.kerning[p]&&(s.x+=P.kerning[p]);var E=v.pop()||{texture:a.Texture.EMPTY,line:0,charCode:0,position:new e.Point};E.texture=P.texture,E.line=y,E.charCode=A,E.position.x=s.x+P.xOffset+this._letterSpacing/2,E.position.y=s.y+P.yOffset,h.push(E),s.x+=P.xAdvance+this._letterSpacing,g=s.x,w=Math.max(w,P.yOffset+P.texture.height),p=A,-1!==b&&c>0&&s.x>c&&(++I,n.removeItems(h,1+b-I,1+T-b),T=b,b=-1,f.push(_),x=Math.max(x,_),y++,s.x=0,s.y+=i.lineHeight,p=null)}}else f.push(g),x=Math.max(x,g),++y,++I,s.x=0,s.y+=i.lineHeight,p=null}var O=l.charAt(l.length-1);"\r"!==O&&"\n"!==O&&(/(?:\s)/.test(O)&&(g=_),f.push(g),x=Math.max(x,g));var B=[];for(T=0;T<=y;T++){var M=0;"right"===this._align?M=x-f[T]:"center"===this._align&&(M=(x-f[T])/2),B.push(M)}var k=h.length,z={},C=[],H=this._activePagesMeshData;for(T=0;T<H.length;T++)m.push(H[T]);for(T=0;T<k;T++){var N=(j=h[T].texture).baseTexture.uid;if(!z[N]){if(!(J=m.pop())){var F=new r.MeshGeometry,L=new r.MeshMaterial(a.Texture.EMPTY);J={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new r.Mesh(F,L),vertices:null,uvs:null,indices:null}}J.index=0,J.indexCount=0,J.vertexCount=0,J.uvsCount=0,J.total=0,J.mesh.texture=new a.Texture(j.baseTexture),J.mesh.tint=this._tint,C.push(J),z[N]=J}z[N].total++}for(T=0;T<H.length;T++)-1===C.indexOf(H[T])&&this.removeChild(H[T].mesh);for(T=0;T<C.length;T++)C[T].mesh.parent!==this&&this.addChild(C[T].mesh);for(var T in this._activePagesMeshData=C,z){var X=(J=z[T]).total;(null===(t=J.indices)||void 0===t?void 0:t.length)>6*X&&!(J.vertices.length<2*r.Mesh.BATCHABLE_SIZE)||(J.vertices=new Float32Array(8*X),J.uvs=new Float32Array(8*X),J.indices=new Uint16Array(6*X)),J.mesh.size=6*X}for(T=0;T<k;T++){var j,D=((S=h[T]).position.x+B[S.line])*o,U=S.position.y*o,W=z[(j=S.texture).baseTexture.uid],R=j.frame,G=j._uvs,Y=W.index++;W.indices[6*Y+0]=0+4*Y,W.indices[6*Y+1]=1+4*Y,W.indices[6*Y+2]=2+4*Y,W.indices[6*Y+3]=0+4*Y,W.indices[6*Y+4]=2+4*Y,W.indices[6*Y+5]=3+4*Y,W.vertices[8*Y+0]=D,W.vertices[8*Y+1]=U,W.vertices[8*Y+2]=D+R.width*o,W.vertices[8*Y+3]=U,W.vertices[8*Y+4]=D+R.width*o,W.vertices[8*Y+5]=U+R.height*o,W.vertices[8*Y+6]=D,W.vertices[8*Y+7]=U+R.height*o,W.uvs[8*Y+0]=G.x0,W.uvs[8*Y+1]=G.y0,W.uvs[8*Y+2]=G.x1,W.uvs[8*Y+3]=G.y1,W.uvs[8*Y+4]=G.x2,W.uvs[8*Y+5]=G.y2,W.uvs[8*Y+6]=G.x3,W.uvs[8*Y+7]=G.y3}for(var T in this._textWidth=x*o,this._textHeight=(s.y+i.lineHeight)*o,z){var J=z[T];if(0!==this.anchor.x||0!==this.anchor.y)for(var Z=0,$=this._textWidth*this.anchor.x,V=this._textHeight*this.anchor.y,q=0;q<J.total;q++)J.vertices[Z++]-=$,J.vertices[Z++]-=V,J.vertices[Z++]-=$,J.vertices[Z++]-=V,J.vertices[Z++]-=$,J.vertices[Z++]-=V,J.vertices[Z++]-=$,J.vertices[Z++]-=V;this._maxLineHeight=w*o;var K=J.mesh.geometry.getBuffer("aVertexPosition"),Q=J.mesh.geometry.getBuffer("aTextureCoord"),tt=J.mesh.geometry.getIndex();K.data=J.vertices,Q.data=J.uvs,tt.data=J.indices,K.update(),Q.update(),tt.update()}for(T=0;T<h.length;T++)v.push(h[T])},o.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},o.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},o.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(o.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!d.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),o.prototype._upgradeStyle=function(t){if("string"==typeof t.font){var e=t.font.split(" ");t.fontName=1===e.length?e[0]:e.slice(1).join(" "),e.length>=2&&(t.fontSize=parseInt(e[0],10))}else t.fontName=t.font.name,t.fontSize="number"==typeof t.font.size?t.font.size:parseInt(t.font.size,10)},o.registerFont=function(t,e){return n.deprecation("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),d.install(t,e)},Object.defineProperty(o,"fonts",{get:function(){return n.deprecation("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),d.available},enumerable:!1,configurable:!0}),o.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},o}(s.Container),y=function(){function t(){}return t.add=function(){h.LoaderResource.setExtensionXhrType("fnt",h.LoaderResource.XHR_RESPONSE_TYPE.DOCUMENT)},t.use=function(e,i){var r=c(e.data);if(r)for(var n=t.getBaseUrl(this,e),a=r.parse(e.data),o={},s=function(t){o[t.metadata.pageFile]=t.texture,Object.keys(o).length===a.page.length&&(e.bitmapFont=d.install(a,o),i())},f=0;f<a.page.length;++f){var l=a.page[f].file,u=n+l,p=!1;for(var g in this.resources){var m=this.resources[g];if(m.url===u){m.metadata.pageFile=l,m.texture?s(m):m.onAfterMiddleware.add(s),p=!0;break}}if(!p){var v={crossOrigin:e.crossOrigin,loadType:h.LoaderResource.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},e.metadata.imageMetadata),parentResource:e};this.add(u,v,s)}}else i()},t.getBaseUrl=function(e,i){var r=i.isDataUrl?"":t.dirname(i.url);return i.isDataUrl&&("."===r&&(r=""),e.baseUrl&&r&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(r+="/")),(r=r.replace(e.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/"),r},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}();return t.BitmapFont=d,t.BitmapFontData=l,t.BitmapFontLoader=y,t.BitmapText=x,t}({},PIXI,PIXI,PIXI,PIXI.utils,PIXI,PIXI,PIXI,PIXI);Object.assign(this.PIXI,_pixi_text_bitmap);
//# sourceMappingURL=text-bitmap.min.js.map
